"use strict";var currentGeoLocation,globalSessionAPI={},globalVenueAPI={},globalEventAPI={},langDimension={},hiddenCount=0,rec=[],afterSignInCallback=!1,touchSessions={};!(function(h){"undefined"==typeof glBT&&(window.glBT={}),glBT.activeEvent=did;var l={},u={ranks:{off:[]},geoLocation:{lat:"",lng:""}},c={},n={},d={filters:{},showtimes:{listing:h(".list",".phpShowtimes"),ul:h(".phpShowtimes ul#venuelist"),container:h(".phpShowtimes .container"),noresults:h(".__no-results")},catTooltip:h(".__body","#category-tooltip"),additionalMessages:{}},e={flags:{showtimes:{}}},p={click:{showtime:{}},mouseenter:{},mouseleave:{},keypress:{}};p.mouseenter={};var g={filterPills:""},a={fresh:{fav:0,rec:0,pop:25,mrb:0,mrs:0,dist:0,relDist:15,geoDist:45,off:-100},returning:{fav:150,rec:40,pop:0,mrb:45,mrs:40,relDist:15,geoDist:45,off:-100}};h.extend(window,{helpers:l,models:u,presenters:n,views:c,render:e,events:p,dom:d,sortingScores:a,offlineVenues:void 0,langDimension:langDimension,templates:g});var s=[{range:"0-0",class:"_sold",text:"Sold Out",score:0},{range:"1-19",class:"_filling",text:"Almost Full",score:11},{range:"20-49",class:"_filling",text:"Filling Fast",score:26},{range:"50-100",class:"_available",text:"Available",score:76}];g.downCinema='<div class="__down-cinema-text">Uh-oh! Bookings for this cinema aren\'t going through because of a connectivity issue. Please try again in some time.</div>',l={sanitize:{date:function(e){return new Date(e.substr(0,4)+"/"+e.substr(4,2)+"/"+e.substr(6,2)+" "+e.substr(8,2)+":"+e.substr(10,2))},time:function(e){var t=e.getHours(),i=e.getMinutes(),e=!1;return 12<t?(t-=12,e=!0):12==t?e=!0:0==t&&(t=12),t+":"+(i=i<10?"0"+i:i)+" "+(e=e?"pm":"am")},boolean:function(i){return"string"==typeof i?"Y"==i?i=!0:"N"==i?i=!1:i:("object"!=typeof i&&"array"!=typeof i||_.each(i,(function(e,t){i[t]=l.sanitize.boolean(e)})),i)}},venueName:function(e){return e.replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,"").replace(/\s/g,"-").toLowerCase()+"/cinema"},render:function(e,o,t){e=h("#"+e).html().split("\n").join("");var i,r,s,a=/([$\^\\\/()|?+*\[\]{}.\-])/g;return t=t||{},i=(s="{{}}").length,r=Math.ceil(i/2),t=s.substr(0,r).replace(a,"\\$1"),a=s.substr(r,i).replace(a,"\\$1")||t,a=new RegExp(t+"[^"+t+a+"]+"+a,"g"),e.replace(a,(function(e){var t,i=e.slice(r,-r),s=i.split("."),a=0,n=s.length;if(i in o)t=o[i];else for(t=o;a<n;a++){if(!(s[a]in t))return e;t=t[s[a]]}return t}))},difference:function(e){for(var t=[],i=e.length-1,s=0;s<e.length-1;s++)if(s!=i)return parseInt(e[s])>parseInt(e[s+1])?t.push(parseInt(e[s])-parseInt(e[s+1])):t.push(parseInt(e[s+1])-parseInt(e[s]))},getLatLongDistance:function(e,t){var i=e.lat,s=t.lat,a=e.lng,n=t.lng;if(0==s||0==n)return 0;e=function(e){return e*(Math.PI/180)},t=e(s-i),a=e(n-a),a=Math.sin(t/2)*Math.sin(t/2)+Math.cos(e(i))*Math.cos(e(s))*Math.sin(a/2)*Math.sin(a/2);return(6371*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))).toFixed(2)},between:function(e,t){var i=Math.min.apply(Math,[e,t]),t=Math.max.apply(Math,[e,t]);return i<this&&this<t},getCatAvailability:function(e){(e=parseInt(e))<0&&(e=0);for(var t,i=0;i<s.length;i++)if(t=void 0,t=s[i].range.split("-"),e>=parseInt(t[0])&&e<=parseInt(t[1]))return s[i]},preg_quote:function(e){return(e+"").replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g,"\\$1")},highlight:function(e,t){return e.replace(new RegExp("("+l.preg_quote(t)+")","gi"),"<span class='_available'><strong>$1</strong></span>")}},Array.prototype.toggle=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return void this.splice(t,1);this.push(e)},Array.prototype.equals=function(e){if(!e)return!1;if(this.length!=e.length)return!1;for(var t=0,i=this.length;t<i;t++)if(this[t]instanceof Array&&e[t]instanceof Array){if(!this[t].equals(e[t]))return!1}else if(this[t]!=e[t])return!1;return!0},currentGeoLocation={geoLocation:{}},p.mouseenter.showtime=function(){d.catTooltip.parent().show(),h(this).parent().hasClass("_sold")||e.tooltip(h(this))},p.mouseleave.showtime=function(){d.catTooltip.html("").parent().hide().css({width:"auto",height:"auto",left:0,top:0});var e=h("#category-tooltip .__seat-ranking-header");0<e.length&&e.remove()},p.click.showtime=function(e){if(e.stopPropagation(),e.preventDefault(),!h(this).parent().hasClass("_sold")){var e=h(this),i=[e.data()];h.each(e.parent().siblings().find(".showtime-pill"),(function(e,t){i.push(h(t).data())}));e={venueCode:e.closest(".list").data("id"),sessionId:e.data("session-id"),displayShowTime:e.data("display-showtime"),sessions:i,cats:e.data("catPopup"),positionKey:e.closest(".list").data("position-key")||0};l.triggerSeatLayout(e);try{u.event[0];var t,s=u.venues[e.venueCode];for(t in u.venues)u.venues[t].id==glBT.SVC&&u.venues[t].isFoodSales;var a=dateSelected.substr(0,4),n=dateSelected.substr(4,2);dateSelected.substr(6,2);e.venueApp=s.venueApp,fireShowtimeSelectedEvent(e)}catch(e){BMS.Misc.fnErr({fnName:"events.click.showtime",err:e})}}},p.click.dropdown=function(e){h(this).hasClass("_disabled")||(h(this).toggleClass("_active"),h(".dropdown-block > .dropdown").not(this).removeClass("_active"),h(".coachmark-language-chk").remove())},p.click.toggleFilters=function(e){if(h(this).hasClass("languages")){BMS.Misc.fnBusy(!0);h(this).attr("data-value");return window.location=h(this).find("a").attr("href"),!1}if(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!h(this).parents(".dropdown").hasClass("filter"))return!1;var t=h(this),i=t.parent().data("type").trim(),s=t.data("value"),e=t.data("range"),t=t.text().trim();_.isEmpty(u.appliedFiltersMapping[i])&&(u.appliedFiltersMapping[i]={}),u.appliedFiltersMapping[i][s]=t,n.toggleFilters({type:i,value:s,range:e})},p.mouseleave.dropdown=function(e){h(".dropdown-block > .dropdown").removeClass("_active")},p.keypress.search=function(e){var t=(t=h(this).val().trim()).replace(/[^a-zA-Z0-9-: ]/g,"");27!=e.keyCode&&27!=e.which||(t="",h(".__search").removeClass("_active"),h("#fltrsearch").blur()),13!=e.keyCode&&13!=e.which||(h(".__search").removeClass("_active"),h("#fltrsearch").blur()),u.appliedFiltersMapping.search={},u.appliedFiltersMapping.search[t]=t,n.toggleFilters({type:"search",value:t})},p.click.heart=function(){var e=h(this),t=e.data("id");(e.hasClass("_active")?fnFavRmv:fnFavAdd)(t)},p.click.removeFilter=function(e){n.toggleFilters(h(this).data(),e)},u.messages={bt:"We only sell a limited quota of the tickets for this cinema. Please check at the box office for more",impact_regal:"We only sell a limited quota of the tickets for this cinema. Please check at the box office for more",seat_ranking:"Popular seats <br/> are remaining!",single_seat_ranking:"Popular seat <br/> is remaining!",seat_ranking_touch:"Popular seats are remaining!",single_seat_ranking_touch:"Popular seat is remaining!"},"undefined"==typeof Showtimes&&(Showtimes={}),u.event=[h.extend(!0,{id:Showtimes.eventCode||"",eventCode:Showtimes.eventCode||"",active:!0},eventDetails)];var o;u.venues=(o={},c.showtimes=[],d.showtimes.listing.each((function(){var i=h(this),s=i.data("id");o[s]={el:i,score:0},h.each(i.data(),(function(e,t){o[s][e]=t,"allowSales"==e&&"O"==t&&u.ranks.off.push(i.data("id"))})),c.showtimes.push({id:s,name:h.trim(i.data("name")),visible:!0,score:0,subRegionId:i.data("subRegionId"),unpaid:i.data("hasUnpaid"),fnb:i.data("isFoodSales")}),i.on("click",".showtime-pill",p.click.showtime),global.blnIsTouchScreen||(i.on("mouseenter",".showtime-pill",p.mouseenter.showtime),i.on("mouseleave",".showtime-pill",p.mouseleave.showtime)),1==i.data("is-down")&&i.find(".showtimes-details-container").append("<div class='__down-cinema-text'>"+i.data("venuedownmsg")+"</div>")})),o),u.ranks={},u.appliedFilters={subRegions:[],showtimes:[],prices:[],search:[],unpaid:[],fnb:[]},u.appliedFiltersMapping={subRegions:[],showtimes:[],prices:[]},n.toggleFilters=function(e,t){if("reset"==e.type)return u.appliedFilters={subRegions:[],showtimes:[],prices:[],search:[],unpaid:[],fnb:[]},n.applyFilters(),BMS.Storage.del({name:"buytickets",key:"filters",value:JSON.stringify(u.appliedFilters)}),void(global.blnIsTouchScreen&&h(".toggle-filters").removeClass("_active"));"prices"==e.type&&(e.value=parseInt(e.value)),"search"===e.type&&(u.appliedFilters.search.length=0),u.appliedFilters[e.type].toggle(e.value),"search"===e.type&&(""===e.value||!_.isUndefined(t)&&h(t.currentTarget).hasClass("__add-pills"))&&(u.appliedFilters.search.length=0,d.filters.searchFilter.val("")),n.applyFilters(),0==u.appliedFilters.subRegions.length&&0==u.appliedFilters.showtimes.length&&0==u.appliedFilters.prices.length&&0==u.appliedFilters.search.length?(BMS.Storage.del({name:"buytickets",key:"filters",value:JSON.stringify(u.appliedFilters)}),global.blnIsTouchScreen&&h(".toggle-filters").removeClass("_active")):BMS.Storage.set({name:"buytickets",key:"filters",value:JSON.stringify(u.appliedFilters)});var i="",s="",a=0;"search"===e.type?a=200:e.range&&(t=e.range.split("-"),i=t[0],s=t[1]),_.debounce((function(){if("search"!==e.type||e.value===u.appliedFilters.search[0])try{BMS.Misc.fnPushEventDataToAnalytics(["WR","KM"],"Applied filters",{"Filter Used":e.type,"Search action":"search"===e.type?"search":"","Search term for clicked search result":"search"===e.type?e.value:"","Lower value":i,"Higer value":s,Page:"buytickets"})}catch(e){}}),a)()},n.applyFilters=function(s){global.blnIsTouchScreen&&h(".toggle-filters").addClass("_active");var a=[];_.each(u.appliedFilters,(function(e,t){var i;if(!0===s)if("unpaid"!==t&&"fnb"!==t){if(!(i="search"===t?d.filters.search.find("input"):d.dropdowns.find('[data-type="'+t+'"]')).length)return void(u.appliedFilters[t].length=0)}else u.appliedFilters[t].length=0;h.isEmptyObject(u.appliedFiltersMapping[t])&&(u.appliedFiltersMapping[t]={}),_.each(e,(function(e){!0!==s||"search"===t||"unpaid"===t||"fnb"===t||i.find('[data-value="'+e+'"]').length?(_.isEmpty(u.appliedFiltersMapping[t][e])&&("search"===t?(d.filters.search.find("input").val(e),u.appliedFiltersMapping[t][e]=e):u.appliedFiltersMapping[t][e]="fnb"===t||"unpaid"===t?e:d.dropdowns.find('[data-value="'+e+'"]').text().trim()),a.push({type:t,value:e,text:u.appliedFiltersMapping[t][e]})):u.appliedFilters[t].toggle(e)}))})),d.filters.pillsContainer.detach().html(""),_.each(a,(function(e){var t=h(BMS.Misc.Helpers.render(g.filterPills,e));t.click(p.click.removeFilter),""!=e.text&&void 0!==e.value&&d.filters.pillsContainer.append(t)})),d.filters.pillsContainer.appendTo(d.filters.pillsWrapper),d.dropdowns.each((function(){var e,t,i;h(this).hasClass("filter")&&(e=h(this),t=e.find(".__text"),i=e.data("type"),0<u.appliedFilters[i].length?(e.addClass("highlighted"),t.addClass("_highlighted").html("")):(e.removeClass("highlighted"),t.removeClass("_highlighted").html(t.data("placeholder"))),e.find("li").each((function(){var e=h(this).data("value");-1<u.appliedFilters[i].indexOf(e)?void 0!==u.appliedFiltersMapping[i][e]&&(h(this).find("input").prop("checked",!0),t[0].innerHTML+=u.appliedFiltersMapping[i][e]+", "):h(this).find("input").removeAttr("checked")})),0<u.appliedFilters[i].length&&(t[0].innerHTML=t[0].innerHTML.substring(0,t[0].innerHTML.length-2)))})),d.dropdowns.each((function(){var e=h(this),t=e.find(".__text");e.hasClass("highlighted")&&""==t.html()&&(e.removeClass("highlighted"),t.removeClass("_highlighted").html(t.data("placeholder")))})),d.showtimes.ul.detach();var t=c.showtimes.length,i=0,r=u.appliedFilters,n=[];function o(e){t--,e.visible&&i++,0==t&&(c.showtimes=n,d.showtimes.ul.appendTo(d.showtimes.container),0==i?d.showtimes.noresults.removeClass("_none"):d.showtimes.noresults.addClass("_none"))}_.each(c.showtimes,(function(e){var t,i;function s(){t.visible=!0,u.venues[t.id].el.removeClass("_none"),i(t)}u.venues[e.id].el.data("offline")?o():(t=e,i=function(e){!(function(t,e){u.venues[t.id].showtimes||(t=(function(t){var i=u.venues[t.id],e=h(".showtime-pill",i.el);return i.showtimes={},t.showtimes=[],e.each((function(){var e=h(this);i.showtimes[e.data("showtimeCode")]={el:e,index:e.data("showtime-filter-index")},t.showtimes.push({id:e.data("showtimeCode"),index:e.data("showtime-filter-index"),visible:!0})})),t})(t));var i,s;function a(e,t){if(0<r.prices.length&&t.visible){var i=u.venues[e.id].showtimes[t.id].el.data("priceFilterIndex");if(!i)return t;0<_.intersection(i,r.prices).length||(t=o(e,t))}return t}function n(e,t){return t.visible=!0,u.venues[e.id].showtimes[t.id].el.parent().removeClass("_none"),t}function o(e,t){return t.visible=!1,s--,u.venues[e.id].showtimes[t.id].el.parent().addClass("_none"),t}t.visible&&(i=[],s=t.showtimes.length,0<r.showtimes.length?_.each(t.showtimes,(function(e){e.index||o(t,e),e=-1<r.showtimes.indexOf(e.index.toString())?(e=n(t,e),a(t,e)):o(t,e),i.push(e)})):_.each(t.showtimes,(function(e){e=n(t,e),e=a(t,e),i.push(e)})),t.showtimes=i,0==s&&(t.visible=!1,u.venues[t.id].el.addClass("_none"))),e(t)})(e,(function(e){function t(){i.visible=!0,u.venues[i.id].el.removeClass("_none").find(".__venue-name").html(l.highlight(i.name,a)),s(i)}var i,s,a;s=function(e){n.push(e),o(e)},(i=e).visible?0<r.search.length?(a=u.appliedFilters.search[0].toLowerCase(),-1!==i.name.toLowerCase().indexOf(a)?t():(i.visible=!1,u.venues[i.id].el.addClass("_none"),s(i))):t():s(i)}))},!(0<r.subRegions.length)||-1<r.subRegions.indexOf(t.subRegionId.toString())?s():(t.visible=!1,u.venues[t.id].el.addClass("_none"),i(t)))}))},n.getUserType=function(){var i,e=(i=!1,_.each(u.ranks,(function(e,t){"off"!=t&&"pop"!=t&&0<e.length&&(i=!0)})),i);return BMS.Storage.isset({name:"ld"})||e?"returning":"fresh"},n.loadRanks=function(){var e=BMS.Storage.get({name:"userCine"}).split("|"),t={fav:[],rec:(function(){try{return recommendations.data.VENUESBYEVENT[u.event[0].id]}catch(e){return[]}})(),pop:[],mrb:[],mrs:[],off:u.ranks.off||[]};_.each(e,(function(e){0<=e.search("fav=")?t.fav=e.replace("fav=","").split(";"):0<=e.search("pop=")?t.pop=e.replace("pop=","").split(";"):0<=e.search("mrb=")?t.mrb=e.replace("mrb=","").split(";"):0<=e.search("mrs=")&&(t.mrs=e.replace("mrs=","").split(";"))})),u.ranks=t},n.rankVenues=function(){n.loadRanks();var s=n.getUserType();_.each(u.ranks,(function(e,i){_.each(e,(function(e){var t=a[s][i];u.venues[e]&&(u.venues[e].score+=t,"fav"==i&&u.venues[e].el.addClass("_favourited").find(".heart-it").addClass("_active"))}))})),""!=u.geoLocation.lat?_.each(c.showtimes,(function(e){var t=u.venues[e.id];e.score=t.score+=(t=parseFloat(t.geoLatLongDistance))<100?parseFloat((a[s].geoDist-t/100*a[s].geoDist).toFixed(2)):0})):_.each(c.showtimes,(function(e){e.score=u.venues[e.id].score}))},n.geoLocation=function(e){u.geoLocation={},u.geoLocation.lat=e.coords.latitude.toString(),u.geoLocation.lng=e.coords.longitude.toString(),BMS.Storage.isset({name:"geoLocation"})||(e=JSON.stringify(u.geoLocation),BMS.Storage.set({name:"geoLocation",value:e,sess:!0,expiry:3600})),_.each(c.showtimes,(function(e){var t=u.venues[e.id];e.geoLocationDistance=t.geoLatLongDistance=l.getLatLongDistance(u.geoLocation,{lat:t.lat||0,lng:t.lng||0}),d.showtimes.listing=h(".list",".phpShowtimes"),d.showtimes.listing.detach()})),n.showtimes({detached:!0})},n.geoLocationError=function(e){n.svg4everybody()};var r=0;n.showtimes=function(e){r++;var t={detached:!1};h.extend(t,e),n.rankVenues(),t.detached||d.showtimes.listing.detach(),c.showtimes=_.sortBy(c.showtimes,(function(e){return-e.score}));var i=[];_.each(c.showtimes,(function(e,t){e=u.venues[e.id].el;e.attr("data-position-key",t+1),i.push(e)})),d.showtimes.ul.append(i),(1==r&&!navigator.geolocation||navigator.geolocation&&t.detached)&&n.svg4everybody()},n.svg4everybody=function(){h(document).ready((function(){svg4everybody&&setTimeout((function(){u.svg4everybody||(u.svg4everybody=!0,svg4everybody())}),1e3)}))},n.priceSpecialFilter=function(){var e=BMS.Misc.fnGQS("ApplicablePriceFilters");BMS.Misc.fnGQS("q")||window.presenters.toggleFilters({type:"reset"}),e&&u.appliedFilters.prices.length<=1&&(e=e[e.length-1],window.presenters.toggleFilters({type:"prices",value:e}))},e.init=function(){BMS.Storage.isset({name:"geoLocation"})?BMS.Storage.isset({name:"geoLocation"})&&(e={coords:{latitude:(e=JSON.parse(BMS.Storage.get({name:"geoLocation"}))).lat,longitude:e.lng}},n.geoLocation(e)):(navigator.geolocation&&navigator.geolocation.getCurrentPosition(n.geoLocation,n.geoLocationError),n.showtimes()),d.dropdowns=h(".dropdown",".dropdown-block"),d.dropdowns.click(p.click.dropdown),d.dropdowns.mouseleave(p.mouseleave.dropdown),d.dropdowns.find(".__menu").mouseleave(p.mouseleave.dropdown),d.dropdowns.find(".__menu").find("li").click(p.click.toggleFilters),d.filters={},d.filters.search=h(".showtimes-search > .__search"),d.filters.searchFilter=d.filters.search.find("input"),d.filters.searchFilter.on("keyup",p.keypress.search),d.filters.pillsWrapper=h(".applied-filters"),d.filters.pillsContainer=h(".added-filters",d.filters.pillsWrapper),h("#reset-filters").on("click",(function(){n.toggleFilters({type:"reset"})})),h(".heart-it").on("click",p.click.heart),global.blnIsTouchScreen&&(h(".toggle-filters").on("tap",(function(){h("html").addClass("no-scroll"),h(".dropdown-block._full-screen").show(),h("#navbar").hide()})),h(".__reset",".dropdown-block").on("click",(function(){n.toggleFilters({type:"reset"}),h("html").removeClass("no-scroll"),h(".dropdown-block._full-screen").hide(),h("#navbar").show()})),h(".__done",".dropdown-block").on("click",(function(){h(".dropdown-block._full-screen").hide(),h("html").removeClass("no-scroll"),h("#navbar").show()})),h(".__close-it").tap((function(){BMS.Modal.fnHideModal()})));var i,e=BMS.Storage.get({name:"buytickets",key:"filters"});e&&(u.appliedFilters=JSON.parse(e),u.appliedFilters.search||(u.appliedFilters.search=[]),u.appliedFilters.unpaid||(u.appliedFilters.unpaid=[]),u.appliedFilters.fnb||(u.appliedFilters.fnb=[]),i={subRegions:[],prices:[],showtimes:[]},h(".dropdown.filter").each((function(){var e=h(this),t=e.data("type");e.find("li").each((function(){i[t].push(h(this).data("value"))})),u.appliedFilters[t]=_.intersection(u.appliedFilters[t],i[t])})),setTimeout((function(){n.applyFilters(!0)}),300))},e.init(),c.filters={},c.filters.languages=[],c.filters.dimensions=[],c.filters.subRegions=[],c.filters.prices=[],c.filters.showtimesFilter=[],e.tooltip=function(e){var t=e,i=d.catTooltip,s=e.data("catPopup"),a=0,n=0,o=!1,r="BT"==u.venues[e.data("venueCode")].el.data("venueApp");i.parent().removeClass("ranking-tooltip item-info-tooltip"),0<e.data("best-available-seats")&&(o=!0,n=e.data("best-available-seats")),o&&(i.parent().addClass("ranking-tooltip"),i.parent().prepend(BMS.Misc.Helpers.render(g.categoryTooltipHeader,{ticketsRemaining:n,remainingText:1==n?u.messages.single_seat_ranking:u.messages.seat_ranking})),a=h(".__seat-ranking-header").outerHeight()),_.each(s,(function(e){i.append(BMS.Misc.Helpers.render(g.categoryTooltip,{availabilityClass:e.availabilityClass+" category-"+s.length,availabilityText:e.availabilityText,price:e.price,desc:e.desc}))})),r&&(i.parent().addClass("item-info-tooltip"),i.append('<span style="width:'+i.parent().width()+'px;" class="item-info">'+u.messages.bt+"</span>"));n=t.offset().left+t[0].getBoundingClientRect().width/2-i.width()/2,r=n+i.parent().width()-window.innerWidth;0<r&&(n-=30+r);a=t.offset().top-i.height()-a;i.parent().css({left:n,top:a})},g.filterPills='<span class="__add-pills" data-type="{{type}}" data-value="{{value}}">{{text}}\t\t    <span class="__remove" >\t\t        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve">\t\t            <use xlink:href="/icons/common-icons.svg#icon-close"></use>\t\t        </svg>\t\t    </span>\t\t</span>',g.categoryTooltip='<div class="{{availabilityClass}}">\t\t\tRs. {{price}}<br/>\t\t\t<i>{{desc}}</i>\t\t\t<span>{{availabilityText}}</span>\t\t</div>',g.categoryPopup='<div class="__categories">\t\t\t<div class="__type-cat">\t\t\t\t<span class="__type">{{desc}}</span><br>\t\t\t\t<span class="__cat {{availabilityClass}}">{{availabilityText}}</span>\t\t\t</div>\t\t\t<div class="__price">Rs. {{price}}</div>\t\t</div>',g.categoryTooltipHeader='<div class="__seat-ranking-header">\t\t\t\t<span class="__seat-icon">\t\t\t\t\t<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve">\t\t\t            <use xlink:href="/icons/buytickets-icons.svg#icon-seat"></use>\t\t\t        </svg>\t\t        </span>\t\t        <div class="__header-text">\t\t        \t<span class="__seats-left">{{ticketsRemaining}}</span>\t\t        \t<div class="__seats-left-text">{{remainingText}}</div>\t\t        </div>\t\t</div>',l.triggerSeatLayout=function(i){try{var e,s="";void 0===e?(e=i.sessions||[],h.each(e,(function(e,t){t.sessionId==i.sessionId&&(s=void 0===t.sessionPopupDesc?"":t.sessionPopupDesc)}))):h.each(e,(function(e,t){t.SessionId==i.sessionId&&(s=void 0===t.SessionPopUpDesc?"":t.SessionPopUpDesc)}));var t=u.venues[i.venueCode],a=void 0===t.messageType?"":t.messageType,n=void 0===t.messageTitle?"":t.messageTitle,o=void 0===u.event[0].popupDescription?"":u.event[0].popupDescription,r=void 0===t.message?"":t.message,l=(o+(""!=o&&""!=r?"<br>":"")+r).trim();""!=(l=s+(""!=s?"<br>":"")+l)?(""==a&&(a="AC"),""==n&&(n="Notes")):l="","undefined"==typeof Showtimes&&(Showtimes={});var c=[h.extend(!0,{id:Showtimes.eventCode||"",eventCode:Showtimes.eventCode||"",active:!0},eventDetails)],d={selected:{time:i.displayShowTime,date:displayDate,ssid:i.sessionId,venueCode:i.venueCode},event:c,venue:[{code:i.venueCode,eventCode:u.event[0].id,name:t.name,appType:t.venueApp,isFullSeatLayout:"Y"===t.isFullSeatLayout.trim(),message:{type:a,title:n,body:l},sessions:_.sortBy(_.map(i.sessions,(function(e){return{dateTime:e.dateTime,id:e.sessionId,attributes:void 0!==e.attributes?e.attributes:"",time:e.displayShowtime,isAtmosEnabled:e.isAtmosEnabled,isAvailable:e.cutOffDateTime>parseInt(nowDate+nowTime)&&"A"==e.availability?"Y":"N",showtimeCode:e.showtimeCode,overallAvailStatus:e.overallAvailStatus+"",cats:e.catPopup}})),(function(e){return e.showtimeCode}))}]};void 0!==u.event[0].seatLayoutEventTitle&&(d.event[0].title=u.event[0].seatLayoutEventTitle);var p=!1;"3D"==u.event[0].dimension&&-1!=h.inArray(i.venueCode,["MUAR","CGAR","CGBO","CGBP","CGMO","CGOS","MCSS","MCVJ"])&&(p=!0),""!==l&&""!==n&&(p=!0),fnSelSh("ET",i.venueCode,i.sessionId,u.event[0].id,i.displayShowTime,d,!1,p)}catch(e){BMS.Misc.fnErr({fnName:"helpers.triggerSeatLayout",fnParams:i,err:e})}},d.catPopup=h("#StCategoryPopup"),l.triggerTouchSeatLayout=function(t){var i=h("#showtime-categories"),s=!1,a=0;i.html(""),h("#showtime-availability").hide(),h(".__show-timing","#StCategoryPopup").html(t.displayShowTime),_.each(t.cats,(function(e){i.append(BMS.Misc.Helpers.render(g.categoryPopup,{availabilityClass:e.availabilityClass,availabilityText:e.availabilityText,price:e.price,desc:e.desc}))})),_.each(t.sessions,(function(e){void 0!==e.bestAvailableSeats&&0<e.bestAvailableSeats&&t.sessionId==e.sessionId&&(s=!0,a=e.bestAvailableSeats)})),s&&(i.addClass("ranking-tooltip"),i.append(BMS.Misc.Helpers.render(g.categoryTooltipHeader,{ticketsRemaining:a,remainingText:1==a?u.messages.single_seat_ranking_touch:u.messages.seat_ranking_touch}))),BMS.Misc.modal("StCategoryPopup",!0),h("#showtime-proceed-touch").off("tap"),h("#showtime-proceed-touch").on("tap",(function(e){return e.stopPropagation(),BMS.Misc.modal("StCategoryPopup",!1),l.triggerSeatLayout(t),!1}))},h((function(){var e,t=BMS.Misc.fnGQS("q","");""!=t&&(e="showtimes",window.presenters.toggleFilters({type:"reset"}),"MOR"==t?0!=h("ul[data-type='showtimes'] li[data-value='morning']").length&&window.presenters.toggleFilters({type:e,value:"morning",range:"00:00-11:59"}):"AFN"==t?0!=h("ul[data-type='showtimes'] li[data-value='afternoon']").length&&window.presenters.toggleFilters({type:e,value:"afternoon",range:"12:00-15:59"}):"EVE"==t?0!=h("ul[data-type='showtimes'] li[data-value='evening']").length&&window.presenters.toggleFilters({type:e,value:"evening",range:"16:00-18:59"}):"NGT"==t?0!=h("ul[data-type='showtimes'] li[data-value='night']").length&&window.presenters.toggleFilters({type:e,value:"night",range:"19:00-23:59"}):"DEL"==t&&window.presenters.toggleFilters({type:"reset"}))}))})(jQuery);var afterSignIn=!1;function fnFavAdd(t){afterSignIn=afterSignIn||!1;try{var e,i,s;BMS.Storage.isset({name:"ld"})?((e=BMS.Storage).get({name:"ld"}),e.get({name:"ld",key:"MEMBEREMAIL"}),i=e.get({name:"ld",key:"LSID"}),s=e.get({name:"ld",key:"MEMBERID",defVal:""}),BMS.Misc.fnDoSecureTrans({venCode:t,cmd:"SETPROFILE",p1:"SETFAVORITE",p2:s,p3:i,p4:t,fnCC:fnFavSuc,fnEC:fnFavFail}),BMS.Misc.fnPushEventDataToAnalytics(["WR"],"Cinemas Page",{"Logged In":""!=BMS.Storage.get({name:"ld"}),Appcode:global.strAppCode,"Favorite Venue ID":t,"Favorite Venue Name":models.venues[t].name}),models.venues[t].el.addClass("_favourited"),models.venues[t].el.find(".heart-it").addClass("_active")):(BMS.SignIn.fnSignIn(!0),null==global.SignInCallBack&&(global.SignInCallBack=[]),BMS.SignIn.fnRegister("showtimes",(function(){afterSignIn=!0,fnFavAdd(t)})))}catch(e){BMS.Misc.fnErr({fnName:"fnFavAdd",fnParams:t,err:e})}}function fnFavFail(t){BMS.Misc.fnErr({fnName:"fnFavFail",fnParams:t,err:e})}function fnFavRmv(t){try{var e,i,s;BMS.Storage.isset({name:"ld"})?((e=BMS.Storage).get({name:"ld"}),e.get({name:"ld",key:"MEMBEREMAIL"}),i=e.get({name:"ld",key:"LSID"}),s=e.get({name:"ld",key:"MEMBERID"}),BMS.Misc.fnDoSecureTrans({venCode:t,cmd:"SETPROFILE",p1:"REMOVEFAVORITE",p2:s,p3:i,p4:t,fnCC:fnFavSuc,fnEC:fnFavFail}),models.venues[t].el.removeClass("_favourited"),models.venues[t].el.find(".heart-it").removeClass("_active")):(null==global.SignInCallBack&&(global.SignInCallBack=[]),BMS.SignIn.fnRegister("showtimes",(function(){afterSignIn=!0,fnFavRmv(t)})),BMS.SignIn.fnSignIn(!0))}catch(e){BMS.Misc.fnErr({fnName:"fnFavRmv",fnParams:t,err:e})}}function fnFavSuc(e){var t=unescape(e),e=BMS.Misc.fnGVal({key:"FAV",data:t});BMS.Storage.set({name:"userCine",key:"fav",value:e,storage:"C",sess:!1});t=e.split(";");BMS.Storage.set({name:"ld",key:"FAV",value:e,storage:"C"}),$("._favourited").removeClass("_favourited"),$(".heart-it").removeClass("_active"),_.each(t,(function(e){models.venues[e]&&(models.venues[e].el.addClass("_favourited"),models.venues[e].el.find(".heart-it").addClass("_active"))})),afterSignIn=afterSignIn&&!1,presenters.showtimes()}function fnHidePastPills(e){1==e?$(".showtimes li.list").each((function(){$(this).hasClass("_connectivity-down")||($(this).find("._past").remove(),$(this).find(".showtime-pill-container").length||$(this).hide())})):2==e&&$(".showtimes li.list").each((function(){var e,t;$(this).hasClass("_connectivity-down")||(e=1,t=$(this).find("._past").length,$(this).find("._past").each((function(){e==t&&$(this).hasClass("_off-avail")||$(this).remove(),e++})),$(this).find(".showtime-pill-container").length||$(this).hide())}))}function fireVenueShowTimeLoadEvent(){try{var e=new Date,t={app_code:global.strAppCode,event_name:"venue_showtimes_viewed",event_type:"screen_view",screen_name:"venue_showtimes",product:"movies",experiment:"",venue_code:Cinema_id,timestamp:e.toISOString(),session_id:BMS.Storage.get({name:"sessionId"})},t=$.extend({},t,BMS.Analytics.commonClickStreamParams());BMS.Misc.fnPushEventDataToAnalytics(["GA"],"",{},t)}catch(e){BMS.Misc.fnErr({fnName:"fireVenueShowTimeLoadEvent",err:e})}}function fireShowtimeSelectedEvent(e){try{var t=BMS.Storage.get({name:"userCine",key:"fav"}),i=new Date,s={app_code:global.strAppCode,event:"gtm_std_event",event_code:Showtimes.eventCode,event_group:eventGroup,event_name:"showtime_selected",event_type:"click",experiment:"",category:e.venueApp,format:eventDetails.dimension,genre:eventGenre,is_favourite:t.includes(e.venueCode),language:eventDetails.language,pagetype:"movie_showtimes",product:"movies",session_id:BMS.Storage.get({name:"sessionId"}),screen_name:"movie_showtimes",show_session_id:e.sessionId,timestamp:i.toISOString(),title:eventDetails.title,venue_code:e.venueCode,display_position:e.positionKey},s=$.extend({},s,BMS.Analytics.commonClickStreamParams());BMS.Misc.fnPushEventDataToAnalytics(["GA"],"",{},s)}catch(e){BMS.Misc.fnErr({fnName:"fireShowtimeSelectedEvent",err:e})}}function topEvents(){try{var e=BMS.Misc.Helpers.getIn(API,["BookMyShow","ShowDetails","0","Event"]),t=[];return e.slice(0,3).forEach((function(e){t.push(BMS.Misc.Helpers.getIn(e,["ChildEvents","0","EventCode"]))})),t.toString()}catch(e){BMS.Misc.fnErr({fnName:"topEvents",err:e})}}$("div[data-online='Y']").on("click",(function(){$(this).closest(".list").find(".__venue-name").text();for(var e=$(".list[data-id]").length,t=($(this).find(".showtime-pill ").attr("data-event-id"),0);t<e;t++)if($(this).closest(".list").data("id")===$(".list").eq(t).data("id")){0;break}})),$(document).ready((function(){"in.bookmyshow.com"!=location.host&&fnHidePastPills(BMS.Misc.fnGQS("past_shows")),"PR"==EventTags&&loyalty.fnIsTargetted()&&global.SignOutCallBack.push((function(){location.reload()})),presenters.priceSpecialFilter();var e=$(".showtime-filters").offset().top;$(window).scroll((function(){$(window).scrollTop()>e+5?($(".filters-container").addClass("sticky-filter _primary_hide"),$(".top-section-container > .__img").hide()):($(".filters-container").removeClass("sticky-filter _primary_show _primary_hide"),$(".top-section-container > .__img").show())}))}));